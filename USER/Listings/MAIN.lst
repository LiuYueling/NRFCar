C51 COMPILER V9.56.0.0   MAIN                                                              12/09/2018 09:23:21 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\OBJ\MAIN.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\Keil_v5\C51\BIN\C51.EXE MAIN.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\USER;
                    -..\Version;..\SYSTEM;..\SYSTEM\delay;..\SYSTEM\uart;..\SYSTEM\timer;..\SYSTEM\spi;..\SYSTEM\adc;..\SYSTEM\pca;..\HARDWAR
                    -E\NRF24L01;..\HARDWARE\Rocker;..\APP;..\APP\NRF_DT) DEFINE(STC_Y5,FOSC=11059200L,UART_BAUD=115200,UART_PARITYBIT=ODD_PAR
                    -ITY,TEST_MODE=1,NRF_CAR_SLAVE) DEBUG OBJECTEXTEND PRINT(.\Listings\MAIN.lst) TABS(2) OBJECT(..\OBJ\MAIN.obj)

line level    source

   1          /**********************************************************************
   2          -  File name : MAIN.c
   3          -  Author : yueling_liu Version: 0.1  Date: 2018年10月01日星期一
   4          -  Description :  main
   5          -  History :
   6             NO.<author>    <time>    <version> <desc>
   7             1.yueling_liu  18/10/01  0.1     project initial
   8          **********************************************************************/
   9          
  10          //--Header File--//
  11          #include "SYS.H"
  12          #include "delay.h"
  13          #include "uart.h"
  14          #include "timer.h"
  15          #include "stdio.h"
  16          #include "intrins.h"
  17          #include "NRF24L01.h"
  18          #include "spi.h"
  19          #include "adc.h"
  20          #include "Rocker.h"
  21          
  22          extern volatile bit UART_Txd_Pre_OK_Flag;
  23          //extern volatile uint16_t ADC_BUFF_CH_0_1_6_7[4];
  24          extern volatile uint16_t ADC_BUFF[2];
  25          
  26          volatile bit Delay_Time0_500ms_Flag = 0;
  27          xdata uint8_t tmp_buf[32];
  28          
  29          sbit LED = P5^4;
  30          sbit Rocker1_Key = P2^2;
  31          //sbit Rocker2_Key = P2^3;
  32          
  33          void System_Init(void)
  34          {
  35   1        /*MCLK Init*/
  36   1        CLK_DIV = 0x00; 
  37   1        
  38   1        /*IO_Init; P0-P7 IO_MODE:准双向IO*/
  39   1        P0M0 = 0x00;
  40   1        P0M1 = 0x00;
  41   1        P1M0 = 0x00;
  42   1        P1M1 = 0x00;
  43   1        P2M0 = 0x00;
  44   1        P2M1 = 0x00;
  45   1        P3M0 = 0x00;
  46   1        P3M1 = 0x00;
  47   1        P4M0 = 0x00;
  48   1        P4M1 = 0x00;
  49   1        P5M0 = 0x00;
  50   1        P5M1 = 0x00;
  51   1        P6M0 = 0x00;
  52   1        P6M1 = 0x00;
C51 COMPILER V9.56.0.0   MAIN                                                              12/09/2018 09:23:21 PAGE 2   

  53   1        P7M0 = 0x00;
  54   1        P7M1 = 0x00;
  55   1        
  56   1        LED = 1;      //LED OFF
  57   1      #ifdef NRF_CAR_MASTER
                Rocker1_Key = 1;
              //  Rocker2_Key = 1;
              #elif defined NRF_CAR_SLAVE
  61   1        
  62   1      #endif
  63   1        
  64   1        EA = 1;       //开启总中断
  65   1        
  66   1      #if (TEST_MODE == 1)  //TEST
  67   1        UART_Init();    //串口初始化
  68   1      #endif
  69   1        
  70   1      #ifdef NRF_CAR_MASTER
                UART_SendString("NRF_CAR_MASTER DEMO\r\n");
                UART_SendString("DEMO Version: 0.1\r\n");
              #elif defined NRF_CAR_SLAVE
  74   1        UART_SendString("NRF_CAR_SLAVE\r\n");
  75   1        UART_SendString("DEMO Version: 0.1\r\n");
  76   1      #endif
  77   1        
  78   1        Timer0_1MS_Init();  //Timer0初始化
  79   1        NRF24L01_Init();  //NRF24L01初始化
  80   1        
  81   1      #ifdef NRF_CAR_MASTER
                Adc_Init();     //ADC初始化
              #elif defined NRF_CAR_SLAVE
  84   1        
  85   1      #endif
  86   1        
  87   1      }
  88          
  89          
  90          /**********************************************************************
  91          -  Function :   int main(void)
  92          -  Description :  main
  93          **********************************************************************/
  94          int main(void)
  95          {
  96   1        System_Init();//系统初始化
  97   1        UART_SendString("System Init OK\r\n");
  98   1        UART_SendString("NRF24L01 Check\r\n");
  99   1        
 100   1        while(NRF24L01_Check())
 101   1        {
 102   2          Delay200ms();
 103   2          UART_SendString("NRF24L01 Error\r\n");
 104   2        }
 105   1        UART_SendString("NRF24L01 OK\r\n");
 106   1        
 107   1      #ifdef NRF_CAR_MASTER
                NRF24L01_TX_Mode();//配置NRF24L01为Tx模式
              #elif defined NRF_CAR_SLAVE
 110   1        NRF24L01_RX_Mode();//配置NRF24L01到RX模式
 111   1      #endif
 112   1        
 113   1        while(1)
 114   1        {
C51 COMPILER V9.56.0.0   MAIN                                                              12/09/2018 09:23:21 PAGE 3   

 115   2          
 116   2      //    if(Delay_Time0_500ms_Flag == 1)
 117   2          {
 118   3            Delay_Time0_500ms_Flag = 0;
 119   3            
 120   3      #ifdef NRF_CAR_MASTER
                    Get_Rocker();//获得摇杆数据
              #elif defined NRF_CAR_SLAVE
 123   3            
 124   3      #endif
 125   3            LED = !LED;
 126   3          }
 127   2          
 128   2      #ifdef NRF_CAR_MASTER
                  
              #elif defined NRF_CAR_SLAVE
 131   2          if(NRF24L01_RxPacket(tmp_buf)==0)//一旦接收到信息,则显示出来.
 132   2          {
 133   3            tmp_buf[29] = '\r';
 134   3            tmp_buf[30] = '\n';
 135   3            tmp_buf[31] = '\0';//加入字符串结束符
 136   3            UART_SendString(tmp_buf);    
 137   3          }
 138   2      #endif
 139   2        }
 140   1        
 141   1      }
 142          
 143          
 144          
 145          
 146          
 147          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    158    ----
   CONSTANT SIZE    =    101    ----
   XDATA SIZE       =     32    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
