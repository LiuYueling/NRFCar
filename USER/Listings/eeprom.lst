C51 COMPILER V9.56.0.0   EEPROM                                                            10/14/2018 16:05:03 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN ..\OBJ\eeprom.obj
COMPILER INVOKED BY: D:\Program Files (x86)\MDK\C51\BIN\C51.EXE ..\SYSTEM\eeprom\eeprom.c OPTIMIZE(8,SPEED) BROWSE INCDI
                    -R(..\USER;..\Version;..\SYSTEM;..\SYSTEM\delay;..\SYSTEM\uart;..\SYSTEM\timer;..\SYSTEM\spi;..\SYSTEM\adc;..\HARDWARE\NR
                    -F24L01) DEFINE(FOSC=11059200L,UART_BAUD=115200,UART_PARITYBIT=NONE_PARITY) DEBUG OBJECTEXTEND PRINT(.\Listings\eeprom.ls
                    -t) OBJECT(..\OBJ\eeprom.obj)

line level    source

   1          #include "eeprom.h"
   2          
   3          
   4          
   5          /*----------------------------
   6          关闭IAP
   7          ----------------------------*/
   8          void IapIdle(void)
   9          {
  10   1          IAP_CONTR = 0;                  //关闭IAP功能
  11   1          IAP_CMD = 0;                    //清除命令寄存器
  12   1          IAP_TRIG = 0;                   //清除触发寄存器
  13   1          IAP_ADDRH = 0x80;               //将地址设置到非IAP区域
  14   1          IAP_ADDRL = 0;
  15   1      }
  16          
  17          /*----------------------------
  18          从ISP/IAP/EEPROM区域读取一字节
  19          ----------------------------*/
  20          uint8_t IapReadByte(uint16_t addr)
  21          {
  22   1          uint8_t dat;                       //数据缓冲区
  23   1      
  24   1          IAP_CONTR = ENABLE_IAP;         //使能IAP
  25   1          IAP_CMD = CMD_READ;             //设置IAP命令
  26   1          IAP_ADDRL = addr;               //设置IAP低地址
  27   1          IAP_ADDRH = addr >> 8;          //设置IAP高地址
  28   1          IAP_TRIG = 0x5a;                //写触发命令(0x5a)
  29   1          IAP_TRIG = 0xa5;                //写触发命令(0xa5)
  30   1          _nop_();                        //等待ISP/IAP/EEPROM操作完成
  31   1          dat = IAP_DATA;                 //读ISP/IAP/EEPROM数据
  32   1          IapIdle();                      //关闭IAP功能
  33   1      
  34   1          return dat;                     //返回
  35   1      }
  36          
  37          /*----------------------------
  38          写一字节数据到ISP/IAP/EEPROM区域
  39          ----------------------------*/
  40          void IapProgramByte(uint16_t addr, uint8_t dat)
  41          {
  42   1          IAP_CONTR = ENABLE_IAP;         //使能IAP
  43   1          IAP_CMD = CMD_PROGRAM;          //设置IAP命令
  44   1          IAP_ADDRL = addr;               //设置IAP低地址
  45   1          IAP_ADDRH = addr >> 8;          //设置IAP高地址
  46   1          IAP_DATA = dat;                 //写ISP/IAP/EEPROM数据
  47   1          IAP_TRIG = 0x5a;                //写触发命令(0x5a)
  48   1          IAP_TRIG = 0xa5;                //写触发命令(0xa5)
  49   1          _nop_();                        //等待ISP/IAP/EEPROM操作完成
  50   1          IapIdle();                                          //关闭IAP功能
  51   1      }
  52          
C51 COMPILER V9.56.0.0   EEPROM                                                            10/14/2018 16:05:03 PAGE 2   

  53          /*----------------------------
  54          扇区擦除
  55          ----------------------------*/
  56          void IapEraseSector(WORD addr)
*** ERROR C141 IN LINE 56 OF ..\SYSTEM\eeprom\eeprom.c: syntax error near 'addr', expected ')'
  57          {
  58   1          IAP_CONTR = ENABLE_IAP;         //使能IAP
  59   1          IAP_CMD = CMD_ERASE;            //设置IAP命令
  60   1          IAP_ADDRL = addr;               //设置IAP低地址
*** ERROR C202 IN LINE 60 OF ..\SYSTEM\eeprom\eeprom.c: 'addr': undefined identifier
  61   1          IAP_ADDRH = addr >> 8;          //设置IAP高地址
*** ERROR C202 IN LINE 61 OF ..\SYSTEM\eeprom\eeprom.c: 'addr': undefined identifier
  62   1          IAP_TRIG = 0x5a;                //写触发命令(0x5a)
  63   1          IAP_TRIG = 0xa5;                //写触发命令(0xa5)
  64   1          _nop_();                        //等待ISP/IAP/EEPROM操作完成
  65   1          IapIdle();                                          //关闭IAP功能
  66   1      }
  67          
  68          
  69          

C51 COMPILATION COMPLETE.  0 WARNING(S),  3 ERROR(S)
